import{r as o,j as e}from"./index-DpKukOXs.js";const oe="funkPromptQueueV1";function ke(t,i){if(!t)return i;try{return JSON.parse(t)}catch{return i}}function L(){return typeof window>"u"?[]:ke(localStorage.getItem(oe),[])}function de(t){typeof window>"u"||localStorage.setItem(oe,JSON.stringify(t))}function Be(t){const i=L(),a=i.findIndex(n=>n.hash===t.hash);return a>=0?i[a]=t:i.push(t),de(i),{updated:a>=0,list:i}}function we(){de([])}function Se(t){return L().map(a=>JSON.stringify(a)).join(`
`)}function Ce(){const t=L(),i=t.length?t[t.length-1].ts:void 0;return{size:t.length,latestTs:i}}const $e=["P-Funk","G-Funk","Jazz-funk","Disco-funk","Boogie","Minneapolis","Neo-soul","Afrobeat fusion","Electro-funk","Funk rock","Funk metal","Modern funk"],Me=["groovy","gritty","cosmic","warm","punchy","dark","lush","vintage"],Te=["tape saturation","light plate reverb","spring reverb","phaser","chorus","auto-wah","bit-crush"],Ee=["60s","70s","80s","90s","2000s","modern"],Pe={Drums:["tight funk kit","snappy snare","crack snare","deep kick","tight kick","swung 16th hats","straight 16th hats","808 hats sprinkle","percussion shakers","congas","claps"],Bass:["slap bass","finger bass","pick bass","analog synth bass","Moog mono bass","sub bass"],Guitar:["wah comp guitar","muted chanks","clean funk guitar","phaser guitar","chorus guitar","rhythm guitar stabs"],Keys:["clav stabs","rhodes EP","wurli EP","grand piano","upright piano","DX-style EP"],Brass:["horn stabs","trumpet section","sax section","bone section","full horns"],Strings:["disco strings","lush pads","pizzicato strings"],Lead:["synth lead","talkbox lead","vocoder line"]},Ae={"synth lead":"synthLD","talkbox lead":"tbx","wah comp guitar":"Gwah","muted chanks":"Gmtd","clean funk guitar":"Gcln","phaser guitar":"Gph","chorus guitar":"Gch","clav stabs":"Clv","rhodes EP":"Rhds","wurli EP":"Wrli","grand piano":"Pno","upright piano":"Upno","analog synth bass":"Bsyn","Moog mono bass":"Bmoog","sub bass":"Bsub","slap bass":"Bslap","finger bass":"Bfin","pick bass":"Bpick","horn stabs":"Hrn","trumpet section":"Tpt","sax section":"Sax","bone section":"Bone","full horns":"Horns","disco strings":"Str","tight kick":"Kt","deep kick":"Kdeep","snappy snare":"Ssnap","crack snare":"Scrk","swung 16th hats":"HHsw16","straight 16th hats":"HH16","tape saturation":"tape70s","light plate reverb":"lpl","spring reverb":"spr",phaser:"phs",chorus:"cho","auto-wah":"awah","bit-crush":"bit"},Re=[{id:"reinstrument",label:"Reinstrument Hook"},{id:"vc",label:"Verse/Chorus"},{id:"aaba",label:"AABA"},{id:"build",label:"Build & Drop"}],Fe=[{id:"layer",label:"Layer Up"},{id:"swap",label:"Swap Colors"},{id:"filter-rise",label:"Filter Rise"},{id:"fx-mutate",label:"FX Mutate"}],Le={LAYER_FUNKEVO:["Bsyn+Gwah","Bsyn+Gwah+Clv","Bsyn+Gwah+Clv+Horns","FullEns"],SWAP_COLOR:["Bsyn+Clv","Bsyn+Gwah","Bsyn+Rhds","Bsyn+tbx","FullEns"],TEXTURE_FILTER:["Gmtd","Gph","Gwah","synthLD","FullEns"]},W=(t,i,a)=>Math.max(i,Math.min(a,t));function E(t,i,a=4){return i*a/t*60}function ne(t){const i=Math.round(t);return`${Math.floor(i/60)}:${String(i%60).padStart(2,"0")}`}function He(t){const i=["Funk",...t.substyles,`${t.bpm}bpm`].join(" "),a=[];switch(t.instruments.length&&a.push(t.instruments.join(", ")),t.arrangement.mode){case"reinstrument":{const n=t.arrangement.reinstrument;a.push(`single hook ${n.hookBars} bars repeats ${n.repeats} evolving (${n.curve})`);break}case"vc":{const n=t.arrangement.vc;a.push(`verse ${n.verseBars} / chorus ${n.chorusBars} pattern x${n.cycles}${n.addBridge?` + bridge ${n.bridgeBars}`:""}`);break}case"aaba":{const n=t.arrangement.aaba;a.push(`A${n.aBars}-A${n.aBars}-B${n.bBars}-A${n.aBars}${n.cycles>1?` x${n.cycles}`:""}`);break}case"build":{const n=t.arrangement.build;a.push(`intro ${n.introBars} → build ${n.buildBars} → drop ${n.dropBars} → post ${n.postBars} (${n.rises} rises)`);break}}return t.mood.length&&a.push(t.mood.join("/")),t.era&&a.push(`${t.era} vibe`),t.fx.length&&a.push(t.fx.join(", ")),`${i} ${a.join(", ")}`.trim()}function K(t){return(Ae[t]||t).replace(/analog/gi,"anlg").replace(/vintage/gi,"vtg").replace(/cosmic/gi,"csm").replace(/groovy/gi,"grv").replace(/warm/gi,"wrm").replace(/punchy/gi,"pchy").replace(/(with|and)/gi,"")}function Oe(t){const i=["Funk",...t.substyles.map(l=>l.split("-")[0].slice(0,2)),`${t.bpm}bpm`],a=[];switch(t.arrangement.mode){case"reinstrument":{const l=t.arrangement.reinstrument;a.push(`H${l.hookBars}x${l.repeats}`,l.curve.replace(/-.*/,"R"));break}case"vc":{const l=t.arrangement.vc;a.push(`V${l.verseBars}C${l.chorusBars}x${l.cycles}`),l.addBridge&&a.push(`Br${l.bridgeBars}`);break}case"aaba":{const l=t.arrangement.aaba;a.push(`A${l.aBars}A${l.aBars}B${l.bBars}A${l.aBars}`),l.cycles>1&&a.push(`x${l.cycles}`);break}case"build":{const l=t.arrangement.build;a.push(`I${l.introBars}Bld${l.buildBars}D${l.dropBars}P${l.postBars}`,`R${l.rises}`);break}}const n={bass:1,kick:1,snare:1,hat:2,hat16:2,perc:2,conga:2,clap:2,guitar:3,clav:3,rhodes:3,wurli:3,piano:3,ep:3,horn:4,brass:4,sax:4,bone:4,string:5,pad:5,lead:6,talkbox:6,vocoder:6},h=l=>{const v=l.toLowerCase();for(const $ in n)if(v.includes($))return n[$];return 7},S=t.instruments.map(l=>K(l)).sort((l,v)=>h(l)-h(v)),k=t.mood.map(l=>K(l)),g=t.fx.map(l=>K(l)),m=t.era?[t.era]:[],C=[S,a,k,m,g].flat(),y=[...i];for(const l of C)if(y.push(l),y.join(" ").replace(/\s+/g," ").trim().length>200){y.pop();break}let j=y.join(" ").replace(/\s+/g," ").trim();return j.length>200&&(j=j.slice(0,200).trim()),j}const _e={substyles:["P-Funk","G-Funk"],bpm:106,meterTop:4,meterBottom:4,era:"70s",instruments:["analog synth bass","wah comp guitar","clav stabs","rhodes EP","horn stabs","swung 16th hats"],mood:["groovy","warm"],fx:["tape saturation"],arrangement:{mode:"reinstrument",reinstrument:{hookBars:4,repeats:0,curve:"layer",preset:"LAYER_FUNKEVO"},vc:{verseBars:8,chorusBars:8,cycles:4,addBridge:!0,bridgeBars:8},aaba:{aBars:8,bBars:8,cycles:1},build:{introBars:8,buildBars:16,dropBars:16,postBars:8,rises:2}},targetSec:230,lengthMode:"short"};function X(t,i,a,n=4){const h=E(t,a,n);return W(Math.round(i/h),4,40)}function le(t){return(t.verseBars+t.chorusBars)*t.cycles+(t.addBridge?t.bridgeBars:0)}function ie(t){return(t.aBars*2+t.bBars+t.aBars)*t.cycles}function ce(t){return t.introBars+t.buildBars+t.dropBars+t.postBars}function Ie(){var re;const[t,i]=o.useState(1),[a,n]=o.useState(()=>{const s={..._e};return s.arrangement.reinstrument.repeats=X(s.bpm,s.targetSec,s.arrangement.reinstrument.hookBars,s.meterTop),s}),[h,S]=o.useState(!1),[k,g]=o.useState(""),[m,C]=o.useState(null),[y,j]=o.useState([]),l=o.useMemo(()=>{switch(a.arrangement.mode){case"reinstrument":{const s=a.arrangement.reinstrument;return E(a.bpm,s.hookBars*s.repeats,a.meterTop)}case"vc":return E(a.bpm,le(a.arrangement.vc),a.meterTop);case"aaba":return E(a.bpm,ie(a.arrangement.aaba),a.meterTop);case"build":return E(a.bpm,ce(a.arrangement.build),a.meterTop);default:return E(a.bpm,64,a.meterTop)}},[a]),v=o.useMemo(()=>He(a),[a]),$=o.useMemo(()=>Oe(a),[a]),H=a.lengthMode==="short"?200:600,u=a.lengthMode==="short"?$:v,[f,Y]=o.useState(""),[M,me]=o.useState(""),[O,ue]=o.useState(""),[q,Z]=o.useState(!1),[ee,G]=o.useState(""),[xe,pe]=o.useState(""),[be,he]=o.useState(!1);o.useEffect(()=>{if(t!==5)return;const s=M||f;if(!s)return;let r=!1;async function c(){S(!0),g(""),C(null),j([]);try{const d=["/docs/lab/summary.json","/docs/lab/next_prompts.json"],[N,B]=await Promise.all(d.map(w=>fetch(w,{cache:"no-store"})));if(!N.ok)throw new Error("summary.json "+N.status);const T=await N.json();let b=[];if(B.ok)try{b=await B.json()}catch{}const J=T.find(w=>w.hash===s),z=b.find(w=>w.hash===s);if(!r&&J&&C(J),!r&&z&&z.patch){const w=String(z.patch).split(/;|\n/).map(Q=>Q.trim()).filter(Q=>Q.length>0);j(w)}J||g("해당 해시 분석 레코드 없음 (Colab 아직 미반영)")}catch(d){r||g(d.message||"분석 로드 실패")}finally{r||S(!1)}}return c(),()=>{r=!0}},[t,M,f]),o.useEffect(()=>{let s=!1;async function r(){try{const c=new TextEncoder().encode(u),d=await crypto.subtle.digest("SHA-1",c),N=Array.from(new Uint8Array(d)).map(B=>B.toString(16).padStart(2,"0")).join("");s||Y(N.slice(0,8))}catch{let c=0;for(let d=0;d<u.length;d++)c=c*31+u.charCodeAt(d)>>>0;s||Y(c.toString(16).slice(0,8).padStart(8,"0"))}}return r(),()=>{s=!0}},[u]);const ge=`${o.useMemo(()=>new Date().toISOString(),[]).replace(/[-:]/g,"").replace(/\..+/,"Z")}__${a.lengthMode}__${f}__${a.bpm}bpm`,P=O||ge,I=P+".mp3",U=P+".wav",se=o.useMemo(()=>`# --- Paste into Colab cell ---
PROMPT_TEXT = ${JSON.stringify(u)}
PROMPT_HASH = '${M||f}'
BPM = ${a.bpm}
MODE = '${a.lengthMode}'
# Expected audio filenames (upload then run analysis):
# ${I}
# ${U}
# After generation, rename your exported files accordingly before upload.
`,[u,f,M,a.bpm,a.lengthMode,I,U]);function je(){Z(!0),G("");try{const s={hash:f,ts:new Date().toISOString(),bpm:a.bpm,mode:a.lengthMode,text:u,filenamePrefix:P},{updated:r}=Be(s);me(f),ue(P),pe(s.ts),F(r?"로컬 큐 업데이트":"로컬 큐 저장")}catch(s){G(s.message||"offline log 실패")}finally{Z(!1)}}function ve(){try{const s=new Blob([Se()],{type:"text/plain"}),r=document.createElement("a");r.href=URL.createObjectURL(s),r.download=`prompts-export-${new Date().toISOString().replace(/[:.]/g,"")}.jsonl`,r.click(),F("Export 다운로드")}catch(s){G(s.message)}}function fe(){we(),F("큐 비움")}const _=(s,r)=>s.includes(r)?s.filter(c=>c!==r):[...s,r],ye=s=>n(r=>({...r,bpm:W(Math.round(s),60,160)})),ae=s=>n(r=>{const c={...r,targetSec:W(s,90,480)};if(c.arrangement.mode==="reinstrument"){const d={...c.arrangement.reinstrument};d.repeats=X(c.bpm,c.targetSec,d.hookBars,c.meterTop),c.arrangement={...c.arrangement,reinstrument:d}}return c}),Ne=s=>n(r=>{const c={...r.arrangement.reinstrument,hookBars:s};return c.repeats=X(r.bpm,r.targetSec,s,r.meterTop),{...r,arrangement:{...r.arrangement,reinstrument:c}}}),A=s=>n(r=>({...r,arrangement:{...r.arrangement,vc:{...r.arrangement.vc,...s}}})),V=s=>n(r=>({...r,arrangement:{...r.arrangement,aaba:{...r.arrangement.aaba,...s}}})),R=s=>n(r=>({...r,arrangement:{...r.arrangement,build:{...r.arrangement.build,...s}}})),[te,F]=o.useState(""),D=s=>navigator.clipboard.writeText(s).then(()=>{F("Copied"),setTimeout(()=>F(""),1200)}),x=({active:s,label:r,onClick:c})=>e.jsx("button",{onClick:c,className:`px-4 py-3 rounded-2xl text-sm md:text-base font-medium border transition ${s?"bg-indigo-600 text-white border-indigo-500 shadow-lg":"bg-neutral-800/40 text-neutral-100 border-neutral-700 hover:border-neutral-500"}`,children:r}),p=({title:s,children:r})=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg md:text-xl font-semibold text-neutral-100",children:s}),r]});return e.jsx("div",{className:"min-h-screen w-full funk-bg text-neutral-50",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-8 md:py-10 relative",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6 bg-gradient-to-r from-indigo-300 via-amber-200 to-cyan-300 bg-clip-text text-transparent",children:"Funk Prompt Wizard v2"}),e.jsx("div",{className:"flex gap-2 mb-8 flex-wrap",children:[1,2,3,4,5].map(s=>e.jsxs("button",{onClick:()=>i(s),className:`px-4 py-2 rounded-full text-sm border ${t===s?"bg-indigo-600 border-indigo-500":"bg-neutral-900 border-neutral-700"}`,children:["Step ",s]},s))}),t===1&&e.jsxs("div",{className:"space-y-8",children:[e.jsx(p,{title:"Substyles",children:e.jsx("div",{className:"flex flex-wrap gap-3",children:$e.map(s=>e.jsx(x,{label:s,active:a.substyles.includes(s),onClick:()=>n(r=>({...r,substyles:_(r.substyles,s)}))},s))})}),e.jsx(p,{title:"Tempo & Target Length / Length Mode",children:e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8 items-start",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm opacity-80",children:"BPM"}),e.jsx("input",{type:"range",min:70,max:150,value:a.bpm,onChange:s=>ye(+s.target.value),className:"w-full"}),e.jsxs("div",{className:"mt-2 text-lg",children:[a.bpm," bpm"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm opacity-80",children:"Target Length"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[[180,210,230,240,270].map(s=>e.jsx(x,{active:a.targetSec===s,label:ne(s),onClick:()=>ae(s)},s)),e.jsx("input",{className:"bg-neutral-900 border border-neutral-700 rounded-xl px-3 py-2 w-28",type:"number",min:90,max:480,value:a.targetSec,onChange:s=>ae(+s.target.value)}),e.jsx("span",{className:"opacity-70 self-center text-sm",children:"sec"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm opacity-80",children:"Length Mode (단일 저장)"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:["short","long"].map(s=>e.jsx(x,{label:s==="short"?"Short (≤200c)":"Long (Narrative)",active:a.lengthMode===s,onClick:()=>n(r=>({...r,lengthMode:s}))},s))}),e.jsxs("div",{className:"mt-2 text-xs text-neutral-400 leading-relaxed",children:["Short: 200자 이내 고밀도 프롬프트 (압축). Long: 더 서술적인 형태(최대 표시 ",H,"자 권장) — 저장 시 하나만 기록."]})]})]})}),e.jsx(p,{title:"Era",children:e.jsx("div",{className:"flex flex-wrap gap-3",children:Ee.map(s=>e.jsx(x,{label:s,active:a.era===s,onClick:()=>n(r=>({...r,era:s}))},s))})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{className:"px-5 py-3 rounded-2xl bg-indigo-600",onClick:()=>i(2),children:"다음 →"})})]}),t===2&&e.jsxs("div",{className:"space-y-8",children:[Object.entries(Pe).map(([s,r])=>e.jsx(p,{title:s,children:e.jsx("div",{className:"flex flex-wrap gap-3",children:r.map(c=>e.jsx(x,{label:c,active:a.instruments.includes(c),onClick:()=>n(d=>({...d,instruments:_(d.instruments,c)}))},c))})},s)),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{className:"px-5 py-3 rounded-2xl bg-neutral-800 border border-neutral-700",onClick:()=>i(1),children:"← 이전"}),e.jsx("button",{className:"px-5 py-3 rounded-2xl bg-indigo-600",onClick:()=>i(3),children:"다음 →"})]})]}),t===3&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs(p,{title:"Arrangement Mode",children:[e.jsx("p",{className:"text-xs text-neutral-400 leading-relaxed mb-3",children:"원하는 전개 방식을 선택하세요. 각 모드는 곡의 에너지 흐름과 반복 패턴을 다른 방식으로 보여줍니다. (한국어 설명: 위 칩에 마우스를 올리거나 선택해 세부 조정)"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:Re.map(s=>e.jsx(x,{label:s.label,active:a.arrangement.mode===s.id,onClick:()=>n(r=>({...r,arrangement:{...r.arrangement,mode:s.id}}))},s.id))})]}),a.arrangement.mode==="reinstrument"&&e.jsxs(p,{title:"Reinstrumented Hook",children:[e.jsx("p",{className:"text-xs text-neutral-400 mb-4",children:"단일 Hook 구간을 여러 번 반복하며 악기를 점진적으로 추가/교체하는 구조입니다. 짧은 Hook을 반복하면서 미묘한 진화감을 강조할 때 효과적입니다."}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm opacity-80",children:"Hook Bars"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:[2,4,8].map(s=>e.jsx(x,{label:`${s} bars`,active:a.arrangement.reinstrument.hookBars===s,onClick:()=>Ne(s)},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm opacity-80",children:"Variation Curve"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:Fe.map(s=>e.jsx(x,{label:s.label,active:a.arrangement.reinstrument.curve===s.id,onClick:()=>n(r=>({...r,arrangement:{...r.arrangement,reinstrument:{...r.arrangement.reinstrument,curve:s.id}}}))},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm opacity-80",children:"Preset"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:Object.keys(Le).map(s=>e.jsx(x,{label:s,active:a.arrangement.reinstrument.preset===s,onClick:()=>n(r=>({...r,arrangement:{...r.arrangement,reinstrument:{...r.arrangement.reinstrument,preset:s}}}))},s))})]})]}),e.jsx("div",{className:"mt-3 text-xs opacity-70",children:"Hook 반복 수는 목표 길이에 따라 자동 계산됩니다."}),e.jsxs("div",{className:"mt-1 text-lg font-semibold",children:["Repeats: ",a.arrangement.reinstrument.repeats]})]}),a.arrangement.mode==="vc"&&e.jsxs(p,{title:"Verse / Chorus",children:[e.jsx("p",{className:"text-xs text-neutral-400 mb-4",children:"Verse(도입/서술)와 Chorus(후렴/핵심 후킹)가 교차 반복되는 가장 보편적인 구조입니다. Bridge를 추가해 대비감을 줄 수 있습니다."}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Verse Bars"}),e.jsx("input",{type:"number",min:4,max:32,value:a.arrangement.vc.verseBars,onChange:s=>A({verseBars:Number(s.target.value)||8}),className:"bg-neutral-900 border border-neutral-700 rounded px-2 py-2 w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Chorus Bars"}),e.jsx("input",{type:"number",min:4,max:32,value:a.arrangement.vc.chorusBars,onChange:s=>A({chorusBars:Number(s.target.value)||8}),className:"bg-neutral-900 border border-neutral-700 rounded px-2 py-2 w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Cycles"}),e.jsx("input",{type:"number",min:2,max:10,value:a.arrangement.vc.cycles,onChange:s=>A({cycles:Number(s.target.value)||4}),className:"bg-neutral-900 border border-neutral-700 rounded px-2 py-2 w-full text-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs opacity-70",children:"Bridge"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"checkbox",checked:a.arrangement.vc.addBridge,onChange:s=>A({addBridge:s.target.checked})}),e.jsx("span",{className:"text-xs",children:"사용"})]}),a.arrangement.vc.addBridge&&e.jsx("input",{type:"number",min:4,max:32,value:a.arrangement.vc.bridgeBars,onChange:s=>A({bridgeBars:Number(s.target.value)||8}),className:"bg-neutral-900 border border-neutral-700 rounded px-2 py-2 w-full text-sm"})]})]}),e.jsxs("div",{className:"mt-3 text-xs text-neutral-400",children:["총 Bars: ",le(a.arrangement.vc)]})]}),a.arrangement.mode==="aaba"&&e.jsxs(p,{title:"AABA",children:[e.jsx("p",{className:"text-xs text-neutral-400 mb-4",children:"고전적인 A-A-B-A 포맷. A는 주제(Theme), B는 대비(Bridge/Release) 섹션입니다. cycles를 늘리면 블록 자체를 반복합니다."}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"A Bars"}),e.jsx("input",{type:"number",min:4,max:32,value:a.arrangement.aaba.aBars,onChange:s=>V({aBars:Number(s.target.value)||8}),className:"bg-neutral-900 border border-neutral-700 rounded px-2 py-2 w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"B Bars"}),e.jsx("input",{type:"number",min:4,max:32,value:a.arrangement.aaba.bBars,onChange:s=>V({bBars:Number(s.target.value)||8}),className:"bg-neutral-900 border border-neutral-700 rounded px-2 py-2 w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Cycles"}),e.jsx("input",{type:"number",min:1,max:6,value:a.arrangement.aaba.cycles,onChange:s=>V({cycles:Number(s.target.value)||1}),className:"bg-neutral-900 border border-neutral-700 rounded px-2 py-2 w-full text-sm"})]})]}),e.jsxs("div",{className:"mt-3 text-xs text-neutral-400",children:["총 Bars: ",ie(a.arrangement.aaba)]})]}),a.arrangement.mode==="build"&&e.jsxs(p,{title:"Build & Drop",children:[e.jsx("p",{className:"text-xs text-neutral-400 mb-4",children:"점진적으로 에너지를 쌓아 올린 뒤(Dynamic Build) 강한 Drop을 만들고, Post 섹션에서 여운/변형 혹은 절반 에너지로 마무리하는 구조입니다."}),e.jsxs("div",{className:"grid md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Intro"}),e.jsx("input",{type:"number",min:2,max:32,value:a.arrangement.build.introBars,onChange:s=>R({introBars:Number(s.target.value)||8}),className:"bg-neutral-900 border border-neutral-700 rounded px-2 py-2 w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Build"}),e.jsx("input",{type:"number",min:4,max:64,value:a.arrangement.build.buildBars,onChange:s=>R({buildBars:Number(s.target.value)||16}),className:"bg-neutral-900 border border-neutral-700 rounded px-2 py-2 w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Drop"}),e.jsx("input",{type:"number",min:4,max:64,value:a.arrangement.build.dropBars,onChange:s=>R({dropBars:Number(s.target.value)||16}),className:"bg-neutral-900 border border-neutral-700 rounded px-2 py-2 w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Post"}),e.jsx("input",{type:"number",min:2,max:32,value:a.arrangement.build.postBars,onChange:s=>R({postBars:Number(s.target.value)||8}),className:"bg-neutral-900 border border-neutral-700 rounded px-2 py-2 w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs opacity-70 mb-1",children:"Rises"}),e.jsx("input",{type:"number",min:0,max:6,value:a.arrangement.build.rises,onChange:s=>R({rises:Number(s.target.value)||0}),className:"bg-neutral-900 border border-neutral-700 rounded px-2 py-2 w-full text-sm"})]})]}),e.jsxs("div",{className:"mt-3 text-xs text-neutral-400",children:["총 Bars: ",ce(a.arrangement.build)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{className:"px-5 py-3 rounded-2xl bg-neutral-800 border border-neutral-700",onClick:()=>i(2),children:"← 이전"}),e.jsx("button",{className:"px-5 py-3 rounded-2xl bg-indigo-600",onClick:()=>i(4),children:"다음 →"})]})]}),t===4&&e.jsxs("div",{className:"space-y-8",children:[e.jsx(p,{title:"Mood",children:e.jsx("div",{className:"flex flex-wrap gap-3",children:Me.map(s=>e.jsx(x,{label:s,active:a.mood.includes(s),onClick:()=>n(r=>({...r,mood:_(r.mood,s)}))},s))})}),e.jsx(p,{title:"FX",children:e.jsx("div",{className:"flex flex-wrap gap-3",children:Te.map(s=>e.jsx(x,{label:s,active:a.fx.includes(s),onClick:()=>n(r=>({...r,fx:_(r.fx,s)}))},s))})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{className:"px-5 py-3 rounded-2xl bg-neutral-800 border border-neutral-700",onClick:()=>i(3),children:"← 이전"}),e.jsx("button",{className:"px-5 py-3 rounded-2xl bg-indigo-600",onClick:()=>i(5),children:"결과 보기 →"})]})]}),t===5&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-neutral-900/70 border border-neutral-800 rounded-2xl p-4",children:[e.jsx("div",{className:"text-sm opacity-80 mb-1",children:"예상 길이"}),e.jsx("div",{className:"text-2xl font-bold",children:ne(l)}),e.jsx("div",{className:"text-xs opacity-60 mt-1",children:"BPM & 구조 기반 추정"})]}),e.jsxs("div",{className:"md:col-span-2 bg-neutral-900/70 border border-neutral-800 rounded-2xl p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"text-sm opacity-80",children:"Final Prompt"}),e.jsx("span",{className:"px-2 py-1 rounded bg-indigo-600 text-xs font-semibold",children:a.lengthMode.toUpperCase()})]}),e.jsx("div",{className:"text-xs text-neutral-400 mb-3 leading-relaxed",children:a.lengthMode==="short"?"고밀도 단문(≤200자). 아래 내용이 그대로 저장됩니다.":"서술형 확장 프롬프트. 연구/분석용 풍부한 정보 포함."}),e.jsx("div",{className:"text-sm whitespace-pre-wrap break-words font-medium tracking-tight prompt-glow",children:u}),e.jsxs("div",{className:`mt-3 text-xs ${u.length>H?"text-red-400":"text-emerald-400"}`,children:[u.length," / ",H,a.lengthMode==="long"&&u.length>H?" (권장 초과)":""]}),e.jsxs("div",{className:"mt-4 flex gap-3 flex-wrap",children:[e.jsx("button",{className:"px-4 py-2 rounded-xl bg-indigo-600",onClick:()=>D(u),children:"프롬프트 복사"}),a.lengthMode==="short"&&e.jsx("button",{className:"px-4 py-2 rounded-xl bg-neutral-800 border border-neutral-700",onClick:()=>D(v),children:"Readable 보기/복사"}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-neutral-700 border border-neutral-600",onClick:()=>D(P),children:"파일 Prefix 복사"}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-neutral-700 border border-neutral-600",onClick:()=>D(se),children:"Colab 스니펫 복사"}),e.jsx("button",{disabled:q,className:`px-4 py-2 rounded-xl ${O?"bg-emerald-600":"bg-fuchsia-600"} disabled:opacity-50`,onClick:je,children:q?"저장 중...":O?"로컬 기록 완료 ✅":"로컬 기록 (Offline)"}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-neutral-700 border border-neutral-600",onClick:ve,children:"Export (.jsonl)"}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-neutral-800 border border-neutral-700",onClick:()=>he(s=>!s),children:"큐 미리보기"}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-neutral-900 border border-neutral-700",onClick:fe,children:"큐 비우기"})]}),O&&e.jsxs("div",{className:"mt-2 text-xs text-emerald-400",children:["Local @ ",new Date(xe).toLocaleTimeString()," / hash ",M]}),ee&&e.jsxs("div",{className:"mt-2 text-xs text-red-400",children:["오류: ",ee]}),be&&e.jsxs("div",{className:"mt-4 p-3 bg-neutral-900/60 border border-neutral-800 rounded-xl max-h-56 overflow-auto text-[11px] font-mono space-y-1",children:[L().length===0&&e.jsx("div",{className:"opacity-50",children:"(큐 비어 있음)"}),L().slice().reverse().map(s=>e.jsxs("div",{className:"border-b border-neutral-800 pb-1 mb-1",children:[e.jsx("div",{className:"text-emerald-400",children:s.hash}),e.jsx("div",{className:"truncate",children:s.text.slice(0,140)}),e.jsxs("div",{className:"opacity-50",children:[s.mode," · ",s.bpm,"bpm · ",s.ts]})]},s.hash)),e.jsxs("div",{className:"sticky bottom-0 pt-1 text-right opacity-70",children:["총 ",Ce().size," 개"]})]}),e.jsxs("div",{className:"mt-6 grid md:grid-cols-3 gap-4 text-xs",children:[e.jsxs("div",{className:"bg-neutral-900/60 border border-neutral-800 rounded-xl p-3 space-y-1",children:[e.jsx("div",{className:"font-semibold",children:"Hash"}),e.jsx("div",{className:"font-mono text-emerald-400",children:f}),e.jsx("div",{className:"opacity-60",children:"sha1·8 (프롬프트 기반)"})]}),e.jsxs("div",{className:"bg-neutral-900/60 border border-neutral-800 rounded-xl p-3 space-y-1",children:[e.jsx("div",{className:"font-semibold",children:"파일 이름 예시"}),e.jsx("div",{className:"font-mono break-all",children:I}),e.jsx("div",{className:"font-mono break-all",children:U})]}),e.jsxs("div",{className:"bg-neutral-900/60 border border-neutral-800 rounded-xl p-3 space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Colab"}),e.jsx("pre",{className:"whitespace-pre-wrap break-words text-[10px] leading-tight font-mono opacity-80 max-h-40 overflow-auto",children:se})]})]}),e.jsxs("div",{className:"mt-8 bg-neutral-900/70 border border-neutral-800 rounded-2xl p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"분석 피드백 (Colab)"}),h&&e.jsx("span",{className:"text-xs text-indigo-400 animate-pulse",children:"불러오는 중..."}),!h&&!k&&m&&e.jsx("span",{className:"text-xs text-emerald-400",children:"동기화됨"}),!h&&k&&e.jsx("span",{className:"text-xs text-red-400",children:"오류"}),e.jsx("button",{onClick:()=>{g(""),C(null),j([]),i(5),(async()=>{const s=M||f;if(s){S(!0),g("");try{const[r,c]=await Promise.all([fetch("/docs/lab/summary.json",{cache:"no-store"}),fetch("/docs/lab/next_prompts.json",{cache:"no-store"})]);if(!r.ok)throw new Error("summary.json "+r.status);const d=await r.json();let N=[];if(c.ok)try{N=await c.json()}catch{}const B=d.find(b=>b.hash===s),T=N.find(b=>b.hash===s);B?C(B):g("해시 분석 레코드 없음"),T!=null&&T.patch&&j(String(T.patch).split(/;|\n/).map(b=>b.trim()).filter(b=>b))}catch(r){g(r.message||"로드 실패")}finally{S(!1)}}})()},className:"text-xs px-2 py-1 rounded bg-neutral-800 border border-neutral-700 hover:border-neutral-500",children:"새로고침"})]}),k&&e.jsx("div",{className:"text-xs text-red-400 mb-2",children:k}),!k&&!m&&!h&&e.jsx("div",{className:"text-xs opacity-60",children:"분석 레코드를 찾지 못했습니다. (Colab 결과 push 대기)"}),m&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 text-xs",children:[e.jsxs("div",{className:"bg-neutral-950/50 border border-neutral-800 rounded-lg p-3 space-y-1",children:[e.jsx("div",{className:"opacity-60",children:"해시"}),e.jsx("div",{className:"font-mono text-emerald-400 text-sm",children:m.hash})]}),e.jsxs("div",{className:"bg-neutral-950/50 border border-neutral-800 rounded-lg p-3 space-y-1",children:[e.jsx("div",{className:"opacity-60",children:"추정 Tempo"}),e.jsxs("div",{className:"font-semibold",children:[(re=m.tempo_librosa)==null?void 0:re.toFixed(2)," bpm"]}),e.jsxs("div",{className:"text-[10px] opacity-60",children:["목표 ",a.bpm," bpm | Δ"," ",m.tempo_librosa?Math.abs(m.tempo_librosa-a.bpm).toFixed(2):"--"]})]}),e.jsxs("div",{className:"bg-neutral-950/50 border border-neutral-800 rounded-lg p-3 space-y-1",children:[e.jsx("div",{className:"opacity-60",children:"LUFS"}),e.jsx("div",{className:"font-semibold",children:m.lufs?m.lufs.toFixed(2):"--"}),e.jsx("div",{className:"text-[10px] opacity-60",children:"(더 밝은 일관성 목표 -16 ±2)"})]}),e.jsxs("div",{className:"bg-neutral-950/50 border border-neutral-800 rounded-lg p-3 space-y-1",children:[e.jsx("div",{className:"opacity-60",children:"Spectral Centroid"}),e.jsx("div",{className:"font-semibold",children:m.spectral_centroid?Math.round(m.spectral_centroid):"--"}),e.jsx("div",{className:"text-[10px] opacity-60",children:"(밸런스 감시)"})]})]}),y.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs font-semibold mb-1",children:"다음 개선 패치 제안"}),e.jsx("ul",{className:"list-disc pl-5 space-y-1 text-[11px]",children:y.map((s,r)=>e.jsx("li",{className:"leading-snug",children:s},r))})]}),y.length===0&&e.jsx("div",{className:"text-[11px] opacity-60",children:"패치 제안 없음 또는 안정 범위 내"}),e.jsx("div",{className:"text-[10px] opacity-50 pt-2 border-t border-neutral-800",children:"Colab 기반 지표. 새 오디오 업로드 & 재분석 후 git push 하면 갱신."})]})]}),e.jsxs("details",{className:"mt-5 group",children:[e.jsx("summary",{className:"cursor-pointer text-xs opacity-60 hover:opacity-100 transition",children:"디버그 / 내부 형태"}),e.jsxs("div",{className:"mt-3 grid md:grid-cols-2 gap-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Readable"}),e.jsx("div",{className:"whitespace-pre-wrap break-words opacity-90",children:v}),e.jsxs("div",{className:"mt-1 opacity-60",children:[v.length," chars"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Compressed (200c 알고리즘)"}),e.jsx("div",{className:"whitespace-pre-wrap break-words opacity-90",children:$}),e.jsxs("div",{className:"mt-1 opacity-60",children:[$.length," chars"]})]})]})]})]})]}),e.jsx("div",{className:"flex gap-3 flex-wrap",children:e.jsx("button",{className:"px-5 py-3 rounded-2xl bg-neutral-800 border border-neutral-700",onClick:()=>i(4),children:"← 수정"})})]}),te&&e.jsx("div",{className:"copy-toast",children:te})]})})}export{Ie as default};
