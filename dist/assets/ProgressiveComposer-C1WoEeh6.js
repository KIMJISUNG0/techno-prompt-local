import{R as f,j as e}from"./index-DpKukOXs.js";import{P as j,b as A}from"./progressiveCategories-DTybiknO.js";function $(o,u){const b=[],g=[],h=[],p=[],m=[];for(const s of j){const a=o[s.id]||[];if(s.min&&a.length<s.min&&s.id!==u&&b.push(s.id),s.max&&a.length>s.max&&g.push(s.id),a.length>1){const r=a.map(N=>N.split("-")[0]);new Set(r).size/r.length<.6&&h.push(s.id)}}const v=j.findIndex(s=>s.id===u);for(let s=v+1;s<j.length;s++){const a=j[s],r=o[a.id]||[];if(a.min&&r.length<a.min){p.push(a.id);break}}!p.length&&!o.mood&&p.push("mood");for(const s of b.slice(0,3)){const a=j.find(d=>d.id===s);if(!a)continue;a.tokens.map(d=>d.id).filter(d=>!(o[s]||[]).includes(d)).slice(0,2).forEach(d=>m.push(`${s}:${d}`))}return{unmetMinimum:b,overMax:g,diversityWarnings:h,nextCategoryPriority:p,tokenSuggestions:m}}function W(){const[o,u]=f.useState(0),[b,g]=f.useState("all"),[h,p]=f.useState("rich"),[m,v]=f.useState({}),[s,a]=f.useState(""),r=j,d=r[Math.min(o,r.length-1)];function N(t,i){const n=r.find(x=>x.id===t);v(x=>{const c=new Set(x[t]||[]);if(c.has(i))c.delete(i);else{if(n.max&&c.size>=n.max)return x;c.add(i)}return{...x,[t]:Array.from(c)}})}function y(){v({}),u(0)}const k=A(m,h),l=$(m,d.id),C=Object.values(m).reduce((t,i)=>t+i.length,0),w=l.unmetMinimum.length;function P(t){const i=r.find(c=>c.id===t),n=m[i.id]||[],x=i.tokens.filter(c=>!s||c.label.toLowerCase().includes(s.toLowerCase()));return x.length?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-[11px] uppercase tracking-wider text-cyan-300",children:i.label}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:[n.length,i.max?"/"+i.max:""]})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:x.map(c=>{const R=n.includes(c.id);return e.jsx("button",{onClick:()=>N(i.id,c.id),className:`px-2 py-[4px] rounded border text-[10px] ${R?"border-cyan-400 text-cyan-200 bg-cyan-600/20":"border-slate-600 text-slate-300 hover:border-cyan-400"}`,children:c.label},c.id)})})]},i.id):null}function S(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 items-center text-[10px]",children:[e.jsx("input",{value:s,onChange:t=>a(t.target.value),placeholder:"filter tokens",className:"px-2 py-[4px] rounded border border-slate-600 bg-slate-900/40 focus:outline-none focus:border-cyan-400"}),e.jsxs("div",{className:"text-slate-500",children:["Picked: ",C]}),w>0&&e.jsxs("div",{className:"text-amber-300",children:["Unmet: ",w]}),e.jsx("button",{onClick:y,className:"px-2 py-[4px] rounded border border-slate-600 text-[10px] hover:border-amber-400",children:"Reset"}),e.jsxs("button",{onClick:()=>p(t=>t==="rich"?"compact":"rich"),className:"px-2 py-[4px] rounded border border-slate-600 text-[10px] hover:border-cyan-400",children:["Prompt: ",h]}),e.jsx("button",{onClick:()=>navigator.clipboard.writeText(k),className:"px-2 py-[4px] rounded border border-emerald-400 text-[10px] text-emerald-200 bg-emerald-600/10",children:"Copy Prompt"}),e.jsx("button",{onClick:()=>g("step"),className:"px-2 py-[4px] rounded border border-slate-600 text-[10px] hover:border-cyan-400",children:"Step Mode"})]}),e.jsx("div",{className:"grid md:grid-cols-2 xl:grid-cols-3 gap-6",children:r.map(t=>P(t.id))})]})}function M(){const t=d,i=m[t.id]||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 items-center text-[10px]",children:[e.jsx("button",{onClick:()=>g("all"),className:"px-2 py-[4px] rounded border border-slate-600 hover:border-cyan-400",children:"All View"}),e.jsxs("div",{className:"text-slate-500",children:["Step ",o+1,"/",r.length]}),e.jsxs("button",{onClick:()=>p(n=>n==="rich"?"compact":"rich"),className:"px-2 py-[4px] rounded border border-slate-600 hover:border-cyan-400",children:["Prompt: ",h]}),e.jsx("button",{onClick:y,className:"px-2 py-[4px] rounded border border-slate-600 hover:border-amber-400",children:"Reset"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm tracking-widest uppercase text-cyan-300 mb-2",children:t.label}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.tokens.map(n=>{const x=i.includes(n.id);return e.jsx("button",{onClick:()=>N(t.id,n.id),className:`btn text-[11px] ${x?"border-cyan-400 text-cyan-200 bg-cyan-600/20":""}`,children:n.label},n.id)})}),e.jsxs("div",{className:"flex gap-3 text-[11px] pt-4",children:[e.jsx("button",{disabled:o===0,onClick:()=>u(n=>Math.max(0,n-1)),className:`btn ${o===0?"opacity-30 cursor-not-allowed":""}`,children:"Prev"}),e.jsx("button",{disabled:o===r.length-1,onClick:()=>u(n=>Math.min(r.length-1,n+1)),className:`btn ${o===r.length-1?"opacity-30 cursor-not-allowed":""}`,children:"Next"})]})]})]})}return e.jsxs("div",{className:"mt-12 space-y-8",children:[e.jsxs("header",{className:"flex flex-wrap gap-3 items-center",children:[e.jsx("h2",{className:"text-lg font-semibold tracking-wider",children:"멀티 장르 프롬프트 컴포저 (리뉴얼)"}),e.jsxs("button",{onClick:()=>g(t=>t==="all"?"step":"all"),className:"btn text-[11px]",children:["View: ",b]}),e.jsx("button",{onClick:y,className:"btn text-[11px]",children:"Reset"}),e.jsxs("button",{onClick:()=>p(t=>t==="rich"?"compact":"rich"),className:"btn text-[11px]",children:["Prompt: ",h]}),e.jsx("button",{onClick:()=>navigator.clipboard.writeText(k),className:"btn btn-accent text-[11px]",children:"Copy Prompt"}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"text-[10px] text-slate-500 flex gap-4",children:[e.jsxs("span",{children:["Picked ",C]}),e.jsxs("span",{children:["Unmet ",w]}),e.jsxs("span",{children:["Diversity Warn ",l.diversityWarnings.length]})]})]}),e.jsx("div",{children:b==="all"?S():M()}),e.jsxs("section",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-[11px] uppercase tracking-wider text-slate-400",children:"Prompt Preview"}),e.jsx("pre",{className:"text-[11px] whitespace-pre-wrap leading-relaxed bg-black/40 rounded border border-slate-700 p-3 max-h-80 overflow-auto",children:k})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-[11px] uppercase tracking-wider text-slate-400",children:"Abstract Suggestions"}),e.jsxs("div",{className:"text-[10px] bg-black/40 rounded border border-slate-700 p-3 space-y-2 max-h-80 overflow-auto",children:[l.unmetMinimum.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Need more picks:"})," ",l.unmetMinimum.join(", ")]}),l.diversityWarnings.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Low diversity:"})," ",l.diversityWarnings.join(", ")]}),l.overMax.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-amber-300",children:"Over limit:"})," ",l.overMax.join(", ")]}),l.nextCategoryPriority.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Next focus:"})," ",l.nextCategoryPriority.join(", ")]}),l.tokenSuggestions.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Token ideas:"})," ",l.tokenSuggestions.join(", ")]}),l.unmetMinimum.length===0&&l.tokenSuggestions.length===0&&e.jsx("div",{className:"text-slate-500",children:"No pressing suggestions – refine freely."})]})]})]})]})}export{W as default};
