import{r as c,j as e}from"./index-DpKukOXs.js";import{c as de,r as xe,e as H,d as pe,b as me,s as O,a as k,f as U,p as F}from"./quality-Cxfz9cC0.js";function ue(s){const d=s.energy>=4?"C2 . C2 . C2 . C2 .":"C2 . . . C2 . . .",l=s.energy>=4?"x.x.x.x.x.x.x.x.":"x.x. . x.x. .",i=s.energy>=4?"C2_ . . G2_ . .":"C2 . . . G2 . . .";return{id:s.id,kick:d,hat:l,bass:i,energy:s.energy,kind:s.kind}}function he(s){return{sections:s.sections.map(ue),totalSections:s.sections.length,generatedAt:Date.now()}}function _(s){return{intent:s.intent,version:s.version,sections:s.sections.map(d=>({...d,roles:{...d.roles}}))}}const be={hats:s=>s.replace(/tight|minimal|dark/g,"bright").replace(/shimmer/,"sparkle"),lead:s=>s.replace(/dark|hazy|looping/g,"vibrant"),pad:s=>s.replace(/dark|warm/g,"luminous")},ge={kick:s=>s.replace(/solid/,"punchy saturated"),bass:s=>s.replace(/sub pulse/,"driving sub pulse"),snare:s=>s.replace(/snappy/,"snappy sharp")},je=(s,d)=>{const l=_(s);return l.sections.forEach(i=>{Object.keys(i.roles).forEach(r=>{const p=be[r];p&&(i.roles[r]=p(i.roles[r]))})}),{draft:l,note:"Applied brighten to hats/lead/pad descriptors"}},fe=s=>{const d=_(s);return d.sections.forEach(l=>{Object.keys(l.roles).forEach(i=>{const r=ge[i];r&&(l.roles[i]=r(l.roles[i]))})}),{draft:d,note:"Enhanced punch for kick/bass/snare."}};function ye(s){return d=>{const l=_(d);return l.sections.forEach(i=>{if(s.includes(i.id)){const r=Math.min(5,i.energy+1);i.energy=r<1?1:r}}),{draft:l,note:`Raised energy for ${s.length} section(s).`}}}function Ne(s,d){return l=>{const i=_(l);return i.sections.forEach(r=>{Object.keys(r.roles).forEach(p=>{const m=r.roles[p];m&&(r.roles[p]=m.replace(s,d))})}),{draft:i,note:`Replaced ${s} → ${d}`}}}function ve(s,d){const l=d.trim();if(!l.startsWith("/"))return null;const[i,...r]=l.slice(1).split(/\s+/);switch(i){case"brighten":return je(s);case"punch":return fe(s);case"raise":return ye(r)(s);case"replace":{const p=r.find(b=>b.startsWith("find=")),m=r.find(b=>b.startsWith("replace="));if(p&&m){const b=p.slice(5),N=m.slice(8);try{const G=new RegExp(b,"gi");return Ne(G,N)(s)}catch{return{draft:s,note:"Invalid regex pattern"}}}return{draft:s,note:"Missing find= / replace="}}default:return{draft:s,note:`Unknown command: ${i}`}}}const we=["90s","2000s","modern","futuristic"],ke=["club","cinematic","lofi","game","ambient","pop"];function Ee(){const[s,d]=c.useState("dark, hypnotic"),[l,i]=c.useState(),[r,p]=c.useState("modern"),[m,b]=c.useState(4),[N,G]=c.useState(3),[R,Y]=c.useState(30),[S,B]=c.useState(),[o,g]=c.useState(null),[u,j]=c.useState(""),[T,V]=c.useState(""),[W,P]=c.useState([]),[K,Z]=c.useState(!1),[f,y]=c.useState(null),[L,ee]=c.useState(!1),[M,Q]=c.useState([]),[h,z]=c.useState(null),[C,E]=c.useState([]),[D,$]=c.useState([]),A=c.useMemo(()=>({moods:s.split(/[,\n]/).map(t=>t.trim()).filter(Boolean),useCase:l,era:r,intensity:de(m),durationSec:N*60+R}),[s,l,r,m,N,R]),v=c.useMemo(()=>xe(A),[A.moods.join(","),l,r,m,N,R]);function te(){const t=me(A,{targetBars:void 0});g(t);const a=O(t);j(a),P([{note:"Initial draft",serialized:a,ts:Date.now()}]),y(k(t)),E([]),$([]),I(t),z(U(t))}function q(){if(!o)return;const t=ve(o,T.trim());if(!t)return;const a=u,n=O(t.draft);g(t.draft),j(n),P(x=>[...x,{note:t.note,serialized:n,ts:Date.now()}]),V(""),y(k(t.draft)),E(x=>[...x,a]),$([]),I(t.draft),z(U(t.draft))}function se(){B(void 0),g(null),j(""),P([]),Q([]),y(null)}function J(t,a){if(!o)return;const n=u,x={...o,sections:o.sections.map((w,oe)=>oe===t?{...w,...a}:w)};g(x);const X=O(x);j(X),P(w=>[...w,{note:`Manual edit section ${t}`,serialized:X,ts:Date.now()}]),y(k(x)),E(w=>[...w,n]),$([]),I(x)}function ae(){if(!u)return;const t="v"+(M.length+1);Q(a=>[...a,{id:t,label:`Var ${a.length+1}`,serialized:u}])}function ne(t){const a=M.find(x=>x.id===t);if(!a)return;j(a.serialized);const n=F(a.serialized);n&&(g(n),y(k(n)),I(n),z(U(n)))}function re(){if(!o)return;const t=o.sections.map(n=>ce(n)).join(`
`),a=`// Exported Pattern Stub
// Sections: ${o.sections.length}
// Generated simplistic role patterns (placeholder)
${t}
`;navigator.clipboard.writeText(a+`
`+u)}function le(){if(!C.length)return;const t=C[C.length-1];E(n=>n.slice(0,-1)),$(n=>[...n,u]),j(t);const a=F(t);a&&(g(a),y(k(a)))}function ie(){if(!D.length)return;const t=D[D.length-1];$(n=>n.slice(0,-1)),E(n=>[...n,u]),j(t);const a=F(t);a&&(g(a),y(k(a)))}function I(t){try{const a=he(t);window.dispatchEvent(new CustomEvent("draft.patterns.update",{detail:a}))}catch{}}function ce(t){const a=t.energy>=4?"C2 . C2 . C2 . C2 .":"C2 . . . C2 . . .",n=t.energy>=4?"x.x.x.x.x.x.x.x.":"x.x. . x.x. .",x=t.energy>=4?"C2_ . . G2_ . .":"C2 . . . G2 . . .";return`// ${t.id} (${t.kind}) energy=${t.energy}
PATTERN ${t.id} KICK ${a}
PATTERN ${t.id} HAT ${n}
PATTERN ${t.id} BASS ${x}`}return typeof window<"u"&&(window.__micTexture=L),e.jsxs("div",{className:"max-w-6xl mx-auto px-6 py-8 space-y-10",children:[e.jsxs("header",{className:"flex flex-wrap gap-4 items-end justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold tracking-wider text-slate-200",children:"Quick Composer"}),e.jsx("p",{className:"text-[11px] text-slate-500 mt-1",children:"Step 1: Enter minimal intent. Step 2: Pick a recommended genre. Step 3: Generate draft & refine with slash commands."})]}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx("button",{onClick:se,className:"btn",children:"Reset"}),o&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>navigator.clipboard.writeText(u),className:"btn btn-accent",children:"Copy Draft"}),e.jsx("button",{onClick:()=>o&&navigator.clipboard.writeText(H(o)),className:"btn",children:"Copy Prompt"}),e.jsx("button",{onClick:ae,className:"btn",children:"Save Var"}),e.jsx("button",{onClick:le,disabled:!C.length,className:`btn ${C.length?"":"opacity-40 cursor-not-allowed"}`,children:"Undo"}),e.jsx("button",{onClick:ie,disabled:!D.length,className:`btn ${D.length?"":"opacity-40 cursor-not-allowed"}`,children:"Redo"}),e.jsx("button",{onClick:re,className:"btn",children:"Export Stub"})]})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h2",{className:"text-sm uppercase tracking-widest text-cyan-300",children:"Intent"}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-[11px] uppercase tracking-wider text-slate-400",children:"Moods"}),e.jsx("textarea",{value:s,onChange:t=>d(t.target.value),rows:3,className:"w-full text-sm rounded border border-slate-700 bg-slate-900/40 px-3 py-2 focus:outline-none focus:border-cyan-400",placeholder:"dark, hypnotic"}),e.jsx("div",{className:"text-[10px] text-slate-500",children:"Comma / newline separated. First mood biases descriptors."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] uppercase tracking-wider text-slate-400 mb-1",children:"Use Case"}),e.jsxs("select",{value:l||"",onChange:t=>i(t.target.value?t.target.value:void 0),className:"w-full text-sm rounded border border-slate-700 bg-slate-900/40 px-2 py-1 focus:outline-none focus:border-cyan-400",children:[e.jsx("option",{value:"",children:"(none)"}),ke.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] uppercase tracking-wider text-slate-400 mb-1",children:"Era"}),e.jsx("select",{value:r,onChange:t=>p(t.target.value),className:"w-full text-sm rounded border border-slate-700 bg-slate-900/40 px-2 py-1 focus:outline-none focus:border-cyan-400",children:we.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[11px] uppercase tracking-wider text-slate-400 mb-1",children:["Intensity: ",m]}),e.jsx("input",{type:"range",min:1,max:5,value:m,onChange:t=>b(Number(t.target.value)),className:"w-full"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] uppercase tracking-wider text-slate-400 mb-1",children:"Duration"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:N,onChange:t=>G(Math.max(0,Number(t.target.value)||0)),className:"w-20 text-sm rounded border border-slate-700 bg-slate-900/40 px-2 py-1 focus:outline-none focus:border-cyan-400"}),e.jsx("span",{className:"text-slate-500 text-xs",children:"min"}),e.jsx("input",{type:"number",value:R,onChange:t=>{let a=Number(t.target.value)||0;a<0&&(a=0),a>59&&(a=59),Y(a)},className:"w-20 text-sm rounded border border-slate-700 bg-slate-900/40 px-2 py-1 focus:outline-none focus:border-cyan-400"}),e.jsx("span",{className:"text-slate-500 text-xs",children:"sec"})]})]}),e.jsxs("div",{className:"text-[11px] text-slate-500 leading-relaxed border border-slate-700 rounded p-2 bg-slate-900/30",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Moods:"})," ",A.moods.join(", ")||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Coverage:"})," ",v.candidates.length?v.candidates[0].moodCoverage.toFixed(2):"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Issues:"})," ",v.issues.length?v.issues.join("; "):"none"]})]})]})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm uppercase tracking-widest text-cyan-300",children:"Recommended Genres"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[v.candidates.map(t=>{const a=S===t.genre;return e.jsxs("button",{onClick:()=>B(t.genre),className:`px-3 py-1 rounded border text-xs transition ${a?"border-cyan-400 text-cyan-200 bg-cyan-600/10":"border-slate-600 text-slate-300 hover:border-cyan-400"}`,children:[e.jsx("span",{className:"font-medium",children:t.genre}),e.jsxs("span",{className:"ml-2 text-[10px] text-slate-500",children:[(t.confidence*100).toFixed(0),"%"]})]},t.genre)}),v.candidates.length===0&&e.jsx("div",{className:"text-[11px] text-slate-500",children:"No candidates – adjust moods."})]}),e.jsx("div",{className:"text-[11px] text-slate-500",children:S?`Selected: ${S}`:"Pick a genre to enable draft generation."}),e.jsx("button",{disabled:!S,onClick:te,className:`mt-2 px-4 py-1.5 rounded border text-xs ${S?"border-emerald-400 text-emerald-200 bg-emerald-600/10 hover:brightness-110":"border-slate-700 text-slate-600 cursor-not-allowed"}`,children:"Generate Draft"})]}),o&&e.jsxs("section",{className:"space-y-4",children:[e.jsx("h2",{className:"text-sm uppercase tracking-widest text-cyan-300",children:"Draft Structure"}),e.jsxs("div",{className:"text-[11px] text-slate-400 flex flex-wrap gap-4 items-center",children:[e.jsx("span",{children:pe(o)}),e.jsx("button",{onClick:()=>Z(t=>!t),className:"px-2 py-[2px] rounded border border-slate-600 hover:border-cyan-400 text-[10px] text-slate-300",children:K?"Hide Section Editor":"Edit Sections"}),e.jsxs("label",{className:"flex items-center gap-1 text-[10px] text-slate-500 cursor-pointer select-none",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:t=>ee(t.target.checked)})," mic texture (placeholder)"]})]}),K&&e.jsxs("div",{className:"rounded border border-slate-700 p-3 bg-black/30 space-y-3",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wider text-slate-500",children:"Section Editor (length / energy)"}),e.jsx("div",{className:"flex flex-col gap-2",children:o.sections.map((t,a)=>e.jsxs("div",{className:"flex flex-wrap gap-2 items-center text-[10px]",children:[e.jsx("span",{className:"font-mono text-slate-500 w-16",children:t.id}),e.jsx("span",{className:"w-14",children:t.kind}),e.jsxs("label",{className:"flex items-center gap-1",children:["bars",e.jsx("input",{type:"number",value:t.bars,onChange:n=>J(a,{bars:Math.max(1,Number(n.target.value)||t.bars)}),className:"w-16 bg-slate-900/50 border border-slate-600 rounded px-1 py-[2px]"})]}),e.jsxs("label",{className:"flex items-center gap-1",children:["energy",e.jsx("input",{type:"number",min:1,max:5,value:t.energy,onChange:n=>J(a,{energy:Math.min(5,Math.max(1,Number(n.target.value)||t.energy))}),className:"w-14 bg-slate-900/50 border border-slate-600 rounded px-1 py-[2px]"})]})]},t.id))})]}),e.jsx("div",{className:"overflow-x-auto rounded border border-slate-700 bg-black/30",children:e.jsxs("table",{className:"min-w-full text-[11px]",children:[e.jsx("thead",{className:"bg-slate-800/50 text-slate-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1 text-left font-medium",children:"ID"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium",children:"Kind"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium",children:"Bars"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium",children:"Energy"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium",children:"Roles (snippet)"})]})}),e.jsx("tbody",{children:o.sections.map(t=>e.jsxs("tr",{className:"border-t border-slate-700/60 hover:bg-white/5",children:[e.jsx("td",{className:"px-2 py-1 font-mono text-slate-500",children:t.id}),e.jsx("td",{className:"px-2 py-1",children:t.kind}),e.jsx("td",{className:"px-2 py-1",children:t.bars}),e.jsx("td",{className:"px-2 py-1",children:t.energy}),e.jsx("td",{className:"px-2 py-1 text-slate-400",children:e.jsx("div",{className:"flex flex-wrap gap-1 max-w-xl",children:Object.entries(t.roles).slice(0,8).map(([a,n])=>e.jsxs("span",{className:"px-1.5 py-[1px] rounded bg-slate-800/70 border border-slate-600/70 text-[10px]",children:[a,":",n.split(/\s+/).slice(0,4).join(" ")]},a))})})]},t.id))})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-[11px] uppercase tracking-wider text-slate-400",children:"Slash Command"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:T,onChange:t=>V(t.target.value),onKeyDown:t=>{t.key==="Enter"&&q()},placeholder:"/brighten or /punch or /raise intro_...",className:"flex-1 text-sm rounded border border-slate-700 bg-slate-900/40 px-3 py-1.5 focus:outline-none focus:border-cyan-400"}),e.jsx("button",{onClick:q,disabled:!T.trim().startsWith("/"),className:`px-3 py-1.5 rounded border text-xs ${T.trim().startsWith("/")?"border-cyan-400 text-cyan-200 bg-cyan-600/10":"border-slate-700 text-slate-600 cursor-not-allowed"}`,children:"Apply"})]}),e.jsx("div",{className:"text-[10px] text-slate-500",children:"Examples: /brighten • /punch • /raise intro_0 drop_2 • /replace find=dark replace=bright"})]}),e.jsxs("div",{className:"grid xl:grid-cols-4 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-[11px] uppercase tracking-wider text-slate-400",children:"Serialized Draft"}),e.jsx("button",{onClick:()=>navigator.clipboard.writeText(u),className:"px-2 py-[3px] rounded border border-slate-600 hover:border-emerald-400 text-[10px] text-slate-300",children:"Copy"})]}),e.jsx("pre",{className:"text-[10px] leading-relaxed bg-black/50 border border-slate-700 rounded p-2 max-h-72 overflow-auto whitespace-pre-wrap",children:u})]}),e.jsxs("div",{className:"space-y-2 xl:col-span-1",children:[e.jsx("h3",{className:"text-[11px] uppercase tracking-wider text-slate-400",children:"Transform Log"}),e.jsxs("div",{className:"text-[10px] space-y-1 max-h-72 overflow-auto",children:[W.map(t=>e.jsxs("div",{className:"border border-slate-700 rounded px-2 py-1 bg-slate-900/40 flex justify-between gap-4",children:[e.jsx("span",{className:"text-slate-300",children:t.note}),e.jsx("span",{className:"text-slate-500",children:new Date(t.ts).toLocaleTimeString()})]},t.ts)),W.length===0&&e.jsx("div",{className:"text-slate-600",children:"No transforms applied."})]}),f&&e.jsxs("div",{className:"mt-3 border border-slate-700 rounded p-2 bg-slate-900/30 space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-400",children:[e.jsx("span",{children:"Quality Score"}),e.jsx("span",{className:f.score<70?"text-amber-300":"text-emerald-300",children:f.score})]}),e.jsxs("div",{className:"text-[10px] text-slate-500",children:["Adj ",f.tokenCounts.adjectives," / Unique ",f.tokenCounts.uniqueAdjectives]}),e.jsxs("ul",{className:"text-[10px] list-disc ml-4 space-y-1",children:[f.issues.map(t=>e.jsx("li",{className:t.severity==="warn"?"text-amber-300":"text-slate-400",children:t.message},t.code)),f.issues.length===0&&e.jsx("li",{className:"text-emerald-300",children:"No issues detected."})]})]}),M.length>0&&e.jsxs("div",{className:"mt-3 border border-slate-700 rounded p-2 bg-slate-900/30 space-y-1",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wider text-slate-400",children:"Variations"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:M.map(t=>e.jsx("button",{onClick:()=>ne(t.id),className:"px-2 py-[2px] rounded border border-slate-600 hover:border-cyan-400 text-[10px] text-slate-300",children:t.label},t.id))})]})]}),h&&e.jsxs("div",{className:"space-y-2 xl:col-span-1",children:[e.jsx("h3",{className:"text-[11px] uppercase tracking-wider text-slate-400",children:"Expert Hints"}),e.jsxs("div",{className:"text-[10px] space-y-2 max-h-72 overflow-auto border border-slate-700 rounded p-2 bg-slate-900/30",children:[e.jsx("div",{className:"text-slate-500",children:h.energyImbalance}),h.missingRoles.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Missing Roles:"})," ",h.missingRoles.join(", ")]}),h.underusedHighEnergy.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Sparse High-Energy Sections:"})," ",h.underusedHighEnergy.join(", ")]}),h.descriptorRepetition.length>0&&e.jsxs("div",{className:"text-slate-400",children:["Repetition:",e.jsxs("span",{className:"text-slate-500",children:[" ",h.descriptorRepetition.map(t=>t.token+"("+t.count+")").join(", ")]})]}),e.jsx("ul",{className:"list-disc ml-4 space-y-1",children:h.suggestions.map((t,a)=>e.jsx("li",{className:"text-slate-300",children:t},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-[11px] uppercase tracking-wider text-slate-400",children:"Live Prompt Preview"}),e.jsx("button",{onClick:()=>o&&navigator.clipboard.writeText(H(o)),className:"px-2 py-[3px] rounded border border-slate-600 hover:border-cyan-400 text-[10px] text-slate-300",children:"Copy"})]}),e.jsx("div",{className:"text-[10px] leading-relaxed bg-black/50 border border-slate-700 rounded p-2 max-h-72 overflow-auto whitespace-pre-wrap",children:o?H(o):"—"})]})]})]})]})}export{Ee as default};
