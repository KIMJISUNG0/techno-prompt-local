import{R as a,j as e}from"./index-DpKukOXs.js";import{c as ae,r as re,b as le,s as I,a as M,f as G,e as H}from"./quality-Cxfz9cC0.js";import{P as ne}from"./progressiveCategories-DTybiknO.js";function oe(){const[f,P]=a.useState("dark, hypnotic"),[m,O]=a.useState(),[h,U]=a.useState("modern"),[p,$]=a.useState(4),[u,F]=a.useState(210),[i,N]=a.useState([]),[y,v]=a.useState({}),[w,z]=a.useState(""),[q,L]=a.useState("flat"),[r,k]=a.useState(null),[Q,S]=a.useState(""),[d,C]=a.useState(null),[c,A]=a.useState(null),[b,B]=a.useState("abstract"),[R,W]=a.useState(!1),[x,_]=a.useState(!0),j=a.useMemo(()=>({moods:f.split(/[\n,]/).map(s=>s.trim()).filter(Boolean),useCase:m,era:h,intensity:ae(p),durationSec:u}),[f,m,h,p,u]),o=a.useMemo(()=>re(j),[j.moods.join(","),m,h,p,u]);a.useEffect(()=>{x&&!i.length&&o.candidates[0]&&N([o.candidates[0].genre])},[x,o.candidates.map(s=>s.genre).join(",")]),a.useEffect(()=>{x&&i.length===1&&!r&&E()},[x,i.join(","),r]);function J(s){N(t=>t.includes(s)?t.filter(l=>l!==s):[...t,s])}function E(){const s=le(j,{});k(s);const t=I(s);S(t),C(M(s)),A(G(s))}function K(){N([]),k(null),S(""),C(null),A(null),v({})}function V(){if(!r)return;const s=Object.values(y).flat();if(!s.length)return;const t=Array.from(new Set(s)).slice(0,12).join(" "),l={...r,sections:r.sections.map(g=>({...g,roles:Object.fromEntries(Object.entries(g.roles).map(([T,te])=>{const D=te.replace(/^\s+|\s+$/g,"");return D.startsWith(t.split(" ")[0])?[T,D]:[T,(t+" "+D).trim()]}))}))};k(l);const n=I(l);S(n),C(M(l)),A(G(l))}function X(s,t){v(l=>{const n=new Set(l[s]||[]);return n.has(t)?n.delete(t):n.add(t),{...l,[s]:Array.from(n)}})}function Y(s){const t=y[s.id]||[],l=s.tokens.filter(n=>!w||n.label.toLowerCase().includes(w.toLowerCase()));return l.length?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[10px] uppercase tracking-wider text-slate-400",children:[e.jsx("span",{children:s.label}),e.jsxs("span",{className:"text-slate-600 lowercase",children:[t.length,s.max?"/"+s.max:""]})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:l.map(n=>{const g=t.includes(n.id);return e.jsx("button",{type:"button",onClick:()=>X(s.id,n.id),title:n.hint||"",className:`px-2 py-[3px] rounded border text-[10px] ${g?"border-cyan-400 text-cyan-200 bg-cyan-600/20":"border-slate-600 text-slate-300 hover:border-cyan-400"}`,children:n.label},n.id)})})]},s.id):null}function Z(){const s=ne;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 items-center text-[10px]",children:[e.jsx("input",{value:w,onChange:t=>z(t.target.value),placeholder:"filter tokens",className:"px-2 py-[4px] rounded border border-slate-600 bg-slate-900/40 focus:outline-none focus:border-cyan-400 text-[10px]"}),e.jsxs("button",{onClick:()=>L(t=>t==="flat"?"group":"flat"),className:"px-2 py-[4px] rounded border border-slate-600 hover:border-cyan-400",children:["Mode: ",q]}),e.jsx("button",{disabled:!r,onClick:V,className:`px-2 py-[4px] rounded border text-[10px] ${r?"border-emerald-400 text-emerald-200 bg-emerald-600/10":"border-slate-700 text-slate-600 cursor-not-allowed"}`,children:"Apply → Roles"}),e.jsx("button",{onClick:()=>v({}),className:"px-2 py-[4px] rounded border border-slate-600 text-[10px] hover:border-amber-400",children:"Clear"}),e.jsxs("div",{className:"text-slate-500",children:["선택 토큰 수: ",Object.values(y).reduce((t,l)=>t+l.length,0)]})]}),e.jsx("div",{className:"grid md:grid-cols-2 xl:grid-cols-3 gap-5",children:s.map(t=>Y(t))})]})}function ee(){return e.jsx("div",{className:"space-y-3",children:r?e.jsx("div",{className:"text-[11px] text-slate-500",children:"Draft roles 편집 UI 예정 (descriptor 정규화 / gap-fill)"}):e.jsx("div",{className:"text-[11px] text-slate-600",children:"Draft 먼저 생성"})})}function se(){return e.jsx("div",{className:"space-y-3",children:r?e.jsx("div",{className:"text-[11px] text-slate-500",children:"Structure timeline / energy curve editor 예정"}):e.jsx("div",{className:"text-[11px] text-slate-600",children:"Draft 먼저 생성"})})}return e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8 space-y-8",children:[e.jsxs("header",{className:"flex flex-wrap items-end gap-4 justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold tracking-wider text-slate-200",children:"Unified Composer (Scaffold)"}),e.jsx("p",{className:"text-[11px] text-slate-500 mt-1",children:"장르/Intent + Abstract · Instrument · Structure 통합 실험 레이아웃 – 단계적 이식."})]}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx("button",{onClick:K,className:"btn",children:"Reset"}),r&&e.jsx("button",{onClick:()=>r&&navigator.clipboard.writeText(H(r)),className:"btn btn-accent",children:"Copy Prompt"}),r&&e.jsx("button",{onClick:()=>navigator.clipboard.writeText(Q),className:"btn",children:"Copy Draft"})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-sm uppercase tracking-widest text-cyan-300",children:"Intent & Genres"}),e.jsx("button",{onClick:()=>W(s=>!s),className:"px-2 py-[3px] rounded border border-slate-600 text-[10px] text-slate-300 hover:border-cyan-400",children:R?"Hide":"Show"})]}),R&&e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-[11px] uppercase tracking-wider text-slate-400",children:"Moods"}),e.jsx("textarea",{value:f,onChange:s=>P(s.target.value),rows:3,className:"w-full text-sm rounded border border-slate-700 bg-slate-900/40 px-3 py-2 focus:outline-none focus:border-cyan-400"}),e.jsx("div",{className:"text-[10px] text-slate-500",children:"쉼표/줄바꿈 분리 – 1번째 mood bias"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] uppercase tracking-wider text-slate-400 mb-1",children:"Use Case"}),e.jsx("input",{value:m||"",onChange:s=>{const t=s.target.value.trim();O(t||void 0)},placeholder:"club / game",className:"w-full text-sm rounded border border-slate-700 bg-slate-900/40 px-2 py-1 focus:outline-none focus:border-cyan-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] uppercase tracking-wider text-slate-400 mb-1",children:"Era"}),e.jsx("select",{value:h,onChange:s=>U(s.target.value),className:"w-full text-sm rounded border border-slate-700 bg-slate-900/40 px-2 py-1 focus:outline-none focus:border-cyan-400",children:["90s","2000s","modern","futuristic"].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[11px] uppercase tracking-wider text-slate-400 mb-1",children:["Intensity ",p]}),e.jsx("input",{type:"range",min:1,max:5,value:p,onChange:s=>$(Number(s.target.value)),className:"w-full"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] uppercase tracking-wider text-slate-400 mb-1",children:"Approx Duration (sec)"}),e.jsx("input",{type:"number",value:u,onChange:s=>F(Math.max(30,Number(s.target.value)||u)),className:"w-full text-sm rounded border border-slate-700 bg-slate-900/40 px-2 py-1 focus:outline-none focus:border-cyan-400"})]}),e.jsxs("div",{className:"text-[11px] text-slate-500 border border-slate-700 rounded p-2 bg-slate-900/30",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Moods:"})," ",j.moods.join(", ")||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Candidates:"})," ",o.candidates.length]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Issues:"})," ",o.issues.join("; ")||"none"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-[11px] uppercase tracking-wider text-slate-400 flex items-center gap-3",children:["Genre / Hybrid Picks",e.jsxs("label",{className:"flex items-center gap-1 text-[10px] font-normal text-slate-500 cursor-pointer select-none",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:s=>_(s.target.checked)})," auto-seed"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.candidates.slice(0,18).map(s=>{const t=i.includes(s.genre);return e.jsxs("button",{onClick:()=>J(s.genre),className:`px-3 py-1 rounded border text-[11px] transition ${t?"border-cyan-400 text-cyan-200 bg-cyan-600/20":"border-slate-600 text-slate-300 hover:border-cyan-400"}`,children:[s.genre,e.jsxs("span",{className:"ml-1 text-[9px] text-slate-500",children:[(s.confidence*100).toFixed(0),"%"]})]},s.genre)}),o.candidates.length===0&&e.jsx("div",{className:"text-[11px] text-slate-500",children:"No genre candidates"})]}),e.jsxs("div",{className:"text-[10px] text-slate-500",children:["선택: ",i.join(", ")||"—"," (hybrid 시퀀스)"]}),!x&&e.jsx("button",{disabled:!i.length,onClick:E,className:`mt-1 px-4 py-1.5 rounded border text-xs ${i.length?"border-emerald-400 text-emerald-200 bg-emerald-600/10":"border-slate-700 text-slate-600 cursor-not-allowed"}`,children:"Seed Draft"})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:["abstract","instrument","structure"].map(s=>e.jsx("button",{onClick:()=>B(s),className:`px-3 py-1 rounded border text-[11px] ${b===s?"border-cyan-400 text-cyan-200 bg-cyan-600/20":"border-slate-600 text-slate-300 hover:border-cyan-400"}`,children:s},s))}),e.jsxs("div",{className:"rounded border border-slate-700 p-4 bg-black/30 min-h-[140px]",children:[b==="abstract"&&Z(),b==="instrument"&&ee(),b==="structure"&&se()]})]}),e.jsxs("section",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-[11px] uppercase tracking-wider text-slate-400",children:"Prompt Preview"}),e.jsx("pre",{className:"text-[10px] leading-relaxed bg-black/50 border border-slate-700 rounded p-2 max-h-72 overflow-auto whitespace-pre-wrap",children:r?H(r):"—"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-[11px] uppercase tracking-wider text-slate-400",children:"Quality"}),d?e.jsxs("div",{className:"text-[10px] space-y-1 border border-slate-700 rounded p-2 bg-slate-900/30",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Score"}),e.jsx("span",{className:d.score<70?"text-amber-300":"text-emerald-300",children:d.score})]}),e.jsxs("div",{className:"text-slate-500",children:["Adj ",d.tokenCounts.adjectives," / Unique ",d.tokenCounts.uniqueAdjectives]}),e.jsxs("ul",{className:"list-disc ml-4 space-y-1",children:[d.issues.map(s=>e.jsx("li",{className:s.severity==="warn"?"text-amber-300":"text-slate-400",children:s.message},s.code)),d.issues.length===0&&e.jsx("li",{className:"text-emerald-300",children:"No issues"})]})]}):e.jsx("div",{className:"text-[10px] text-slate-500",children:"Draft 없음"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-[11px] uppercase tracking-wider text-slate-400",children:"Expert Hints"}),c?e.jsxs("div",{className:"text-[10px] space-y-2 max-h-72 overflow-auto border border-slate-700 rounded p-2 bg-slate-900/30",children:[e.jsx("div",{className:"text-slate-500",children:c.energyImbalance}),c.missingRoles.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Missing:"})," ",c.missingRoles.join(", ")]}),c.underusedHighEnergy.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Sparse HE:"})," ",c.underusedHighEnergy.join(", ")]}),c.descriptorRepetition.length>0&&e.jsxs("div",{className:"text-slate-400",children:["Repetition:"," ",e.jsx("span",{className:"text-slate-500",children:c.descriptorRepetition.map(s=>s.token+"("+s.count+")").join(", ")})]}),e.jsx("ul",{className:"list-disc ml-4 space-y-1",children:c.suggestions.map((s,t)=>e.jsx("li",{className:"text-slate-300",children:s},t))})]}):e.jsx("div",{className:"text-[10px] text-slate-500",children:"Draft 없음"})]})]})]})}export{oe as default};
